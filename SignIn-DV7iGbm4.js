import{ax as S,ay as h,az as i,aB as w,aC as V,aA as C,aD as F}from"./page-B_49irC7.js";import{E as B,a as E}from"./el-form-item-Bc_VG71O.js";import{u as q}from"./user-BJfK0SpK.js";import{j as z,r as A,E as x,a8 as D,l as N,m as R,n as s,v as f,B as o,Y as _,ad as $,ae as U,af as L}from"./index-C8Xwlcnz.js";const T=d=>($("data-v-34c3fdc0"),d=d(),U(),d),Z={class:"card-header"},j=T(()=>f("span",null,"登录",-1)),M={class:"box"},P=z({__name:"SignIn",setup(d){const c=q(),g=S(),p=A(),r=x({username:"",password:""}),b=n=>{n&&(n.resetFields(),i.success("重置成功"))},v=x({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:10,message:"仅支持5-10个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"只能输入数字和字母",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,max:16,message:"长度为5-16",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"只能输入数字和字母",trigger:"blur"}]}),k=async n=>{n&&await n.validate(async(t,l)=>{t?w.post(g.api+"/signin",{username:r.username,password:r.password},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){if(a.status===200)if(a.data.code===200){const m=a.data.token.access_token;localStorage.setItem("token",m),V.success({title:"登录成功",message:"欢迎回来，"+r.username}),w.get(g.api+"/user",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(e){e.status===200?e.data.code===200?(i.success("刷新用户信息成功"),c.userData.username=e.data.data.username,c.userData.vip_expiration_timestamp=e.data.data.vip_expiration_timestamp,c.userData.qq_bind=e.data.data.qq_bind):i.error(e.data.msg):e.status===401?i({message:"登录失败333",type:"success"}):i.error("请求失败")}).catch(function(e){alert(e),console.log(e)})}else alert(a.data.msg);else a.status===401?alert("登录失效"):(console.log(a),alert("登录失败"))}).catch(function(a){alert(a),console.log(a)}):console.log("error submit!",l)})};return(n,t)=>{const l=C,a=D("RouterLink"),m=F,e=B,y=E,I=h;return N(),R(I,{style:{"max-width":"480px"}},{header:s(()=>[f("div",Z,[j,o(a,{to:"/"},{default:s(()=>[o(l,{type:"danger",size:"small"},{default:s(()=>[_("关闭")]),_:1})]),_:1})])]),default:s(()=>[f("div",M,[o(y,{model:r,rules:v,ref_key:"ruleFormRef",ref:p,"label-width":"auto",style:{"max-width":"600px"},"status-icon":""},{default:s(()=>[o(e,{label:"用户名：",prop:"username"},{default:s(()=>[o(m,{modelValue:r.username,"onUpdate:modelValue":t[0]||(t[0]=u=>r.username=u)},null,8,["modelValue"])]),_:1}),o(e,{label:"登录密码：",prop:"password"},{default:s(()=>[o(m,{modelValue:r.password,"onUpdate:modelValue":t[1]||(t[1]=u=>r.password=u),type:"password"},null,8,["modelValue"])]),_:1}),o(e,null,{default:s(()=>[o(l,{type:"primary",onClick:t[2]||(t[2]=u=>k(p.value))},{default:s(()=>[_("登录")]),_:1}),o(l,{onClick:t[3]||(t[3]=u=>b(p.value))},{default:s(()=>[_("清空")]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1})}}}),K=L(P,[["__scopeId","data-v-34c3fdc0"]]);export{K as default};
