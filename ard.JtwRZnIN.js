import{ao as y,ar as V,ap as u,as as b,aq as F,at as q}from"./ard.B32tsdnC.js";import{E as C,a as E}from"./ard.CF9i62zO.js";import{u as B}from"./ard.C3bxEZKY.js";import{E as x}from"./ard.DDoC5IOL.js";import{d as z,r as N,z as w,h as R,j as s,a5 as $,f as A,l as c,x as o,V as f,ab as D,ac as U,ad as L}from"./ard.DAoQzSGD.js";import"./ard.Cqh_w9uZ.js";const T=d=>(D("data-v-f767b153"),d=d(),U(),d),Z={class:"card-header"},j=T(()=>c("span",null,"登录",-1)),M={class:"box"},P={class:"signInButtonbox"},G=z({__name:"SignIn",setup(d){const p=B(),g=y(),_=N(),r=w({username:"",password:""}),v=n=>{n&&(n.resetFields(),u.success("重置成功"))},h=w({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,max:10,message:"仅支持5-10个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"只能输入数字和字母",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:5,max:16,message:"长度为5-16",trigger:"blur"},{pattern:/^[a-zA-Z0-9]+$/,message:"只能输入数字和字母",trigger:"blur"}]}),I=async n=>{n&&await n.validate(async(t,l)=>{t?b.post(g.api+"/signin",{username:r.username,password:r.password},{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){if(a.status===200)if(a.data.code===200){const m=a.data.token.access_token;localStorage.setItem("token",m),x.success({title:"登录成功",message:"欢迎回来，"+r.username}),b.get(g.api+"/user",{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}).then(function(e){e.status===200?e.data.code===200?(u.success("刷新用户信息成功"),p.userData.username=e.data.data.username,p.userData.vip_expiration_timestamp=e.data.data.vip_expiration_timestamp,p.userData.qq_bind=e.data.data.qq_bind):u.error(e.data.msg):e.status===401?u({message:"登录失败333",type:"success"}):u.error("请求失败")}).catch(function(e){alert(e),console.log(e)})}else alert(a.data.msg);else a.status===401?alert("登录失效"):(console.log(a),alert("登录失败"))}).catch(function(a){x.error({title:"登录失败",message:a})}):console.log("error submit!",l)})};return(n,t)=>{const l=F,a=$("RouterLink"),m=q,e=C,k=E,S=V;return A(),R(S,{style:{"max-width":"480px"}},{header:s(()=>[c("div",Z,[j,o(a,{to:"/"},{default:s(()=>[o(l,{type:"danger",size:"small"},{default:s(()=>[f("关闭")]),_:1})]),_:1})])]),default:s(()=>[c("div",M,[o(k,{model:r,rules:h,ref_key:"ruleFormRef",ref:_,"label-width":"auto",style:{"max-width":"600px"},"status-icon":""},{default:s(()=>[o(e,{label:"用户名：",prop:"username"},{default:s(()=>[o(m,{modelValue:r.username,"onUpdate:modelValue":t[0]||(t[0]=i=>r.username=i)},null,8,["modelValue"])]),_:1}),o(e,{label:"登录密码：",prop:"password"},{default:s(()=>[o(m,{modelValue:r.password,"onUpdate:modelValue":t[1]||(t[1]=i=>r.password=i),type:"password"},null,8,["modelValue"])]),_:1}),c("div",P,[o(l,{type:"primary",onClick:t[2]||(t[2]=i=>I(_.value))},{default:s(()=>[f("登录")]),_:1}),o(l,{onClick:t[3]||(t[3]=i=>v(_.value))},{default:s(()=>[f("清空")]),_:1})])]),_:1},8,["model","rules"])])]),_:1})}}}),X=L(G,[["__scopeId","data-v-f767b153"]]);export{X as default};
